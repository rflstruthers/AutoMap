@model WebApplication2.Models.Polygon
@{
    ViewBag.Title = "Area";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<title>@ViewBag.Title</title>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    

    
</head>

<body>

    <h2>Areas: </h2>
    @{
        <table class="table">
            <tr>
                <th>
                    Area ID
                </th>
                <th>
                    Area Name
                </th>
                <th></th>
            </tr>

            <tr>
                <td>
                    @Html.DisplayFor(modelItem => Model.PolygonID)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => Model.PolygonName)
                </td>
            </tr>
            <td>
                <input type="button" value="Save Changes" id="SaveChanges" class="btn btn-primary" style="height:29px; line-height:75%; border-radius:0;" />
            </td>
            @*<td>
                <input type="button" value="Delete Area" id="DeleteArea" class="btn btn-primary" style="height:29px; line-height:75%; border-radius:0;" />
            </td>*@
            @*<td>
                <a href="@Url.Action("DeletePolygon", "Company", new { polyId = Model.PolygonID }, null)" title="Delete Area"><i class="btn btn-primary" style="height:29px; line-height:75%; border-radius:0;">Delete Area</i></a>
            </td>*@
        </table>
    }

    <div id="map" style="height:400px;width:100%;"></div>

    <script>


        function initMap() {

            var myArray = [];

           @foreach(var d in Model.Points)
           {
            @:myArray.push({lat: @d.Latitude,lng: @d.Longitude});
           }

            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 11,
                center: myArray[0],
                mapTypeId: 'satellite'
            });

            // Construct the polygon.
            var polygon = new google.maps.Polygon({
                path: myArray,
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.35,
                editable: true
            });

            polygon.setMap(map);

            // set event listeners for when vertex are moved, and capture them with button click
            google.maps.event.addListener(polygon.getPath(), 'set_at', processVertex);
            //google.maps.event.addListener(polygon.getPath(), 'insert_at', processVertex);
            var polyPoints = []
            var polyPointsPost = []
            function processVertex(e) {
                var newPoints = []
                for (var i = 0; i < this.getLength(); i++) {
                    newPoints.push(this.getAt(i));
                    polyPoints = newPoints;      
                } 
            }

            $('#SaveChanges').click(function (e) {
                // post new polygon data to UpdatePolygon method
                var url = "@Url.Action("UpdatePolygon","Company")";

                var model = { polyPoints: JSON.stringify(polyPoints), polyId: @Model.PolygonID, polyName: '@Model.PolygonName' };
               
                $.ajax({
                    type: 'POST',
                    data: model,
                    url: url,
                    success: function (data) {
                        window.location.href = data;
                    }
                });
            });

            @*$('#DeleteArea').click(function (e) {
                // post new polygon data to DeletePolygon method
                var url = "@Url.Action("DeletePolygon","Company")";

                var model = { polyId: @Model.PolygonID };
               
                $.ajax({
                    type: 'POST',
                    data: model,
                    url: url,
                    success: function (data) {
                        window.location.href = data;
                    }
                });
            });*@

            google.maps.event.addDomListener(window, "load", initialize);

        }


    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlNR7AYiRN1PF6p3tf9q7B28fk5d8Dx6o&callback=initMap"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</body>

@*AIzaSyAlNR7AYiRN1PF6p3tf9q7B28fk5d8Dx6o*@
